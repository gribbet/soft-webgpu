var dt=Object.defineProperty;var yt=(e,t,r)=>t in e?dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var g=(e,t,r)=>yt(e,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const L=64,he=16,w=(e,t,r)=>{const n=e.createBuffer({size:r.byteLength,usage:t|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),s=r instanceof Uint32Array?Uint32Array:Float32Array;return new s(n.getMappedRange()).set(r),n.unmap(),n},K=(e,t,r)=>e.createBindGroup({layout:t.getBindGroupLayout(0),entries:r.map((n,s)=>({binding:s,resource:{buffer:n}}))}),ht=async({device:e,vertexCount:t,positionBuffer:r,previousBuffer:n,boundaryBuffer:s})=>{const o=e.createShaderModule({code:await(await fetch(new URL("data:text/wgsl;base64,QGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjxzdG9yYWdlLCByZWFkPiBib3VuZGFyaWVzOiBhcnJheTxCb3VuZGFyeT47IApAZ3JvdXAoMCkgQGJpbmRpbmcoMSkgdmFyPHN0b3JhZ2UsIHJlYWRfd3JpdGU+IHBvc2l0aW9uczogYXJyYXk8dmVjMjxmMzI+PjsKQGdyb3VwKDApIEBiaW5kaW5nKDIpIHZhcjxzdG9yYWdlLCByZWFkX3dyaXRlPiBwcmV2aW91c2VzOiBhcnJheTx2ZWMyPGYzMj4+OwoKY29uc3QgZnJpY3Rpb24gPSAwLjU7CgpzdHJ1Y3QgQm91bmRhcnkgewogICAgbm9ybWFsOiB2ZWMyPGYzMj4sCiAgICBvZmZzZXQ6IGYzMgp9OwoKQGNvbXB1dGUgQHdvcmtncm91cF9zaXplKDY0KQpmbiBtYWluKEBidWlsdGluKGdsb2JhbF9pbnZvY2F0aW9uX2lkKSBnbG9iYWxfaWQ6IHZlYzM8dTMyPikgewogICAgbGV0IGkgPSBnbG9iYWxfaWQueDsKCiAgICB2YXIgcG9zaXRpb24gPSBwb3NpdGlvbnNbaV07CiAgICB2YXIgcHJldmlvdXMgPSBwcmV2aW91c2VzW2ldOwoKICAgIGZvciAodmFyIGogPSAwdTsgaiA8IGFycmF5TGVuZ3RoKCZib3VuZGFyaWVzKTsgaisrKSB7CiAgICAgICAgbGV0IGJvdW5kYXJ5ID0gYm91bmRhcmllc1tqXTsKICAgICAgICBsZXQgbm9ybWFsID0gYm91bmRhcnkubm9ybWFsOwogICAgICAgIGxldCBvZmZzZXQgPSBib3VuZGFyeS5vZmZzZXQ7CgogICAgICAgIGxldCBkaXN0YW5jZSA9IGRvdChwb3NpdGlvbiwgbm9ybWFsKSAtIG9mZnNldDsKICAgICAgICBpZiBkaXN0YW5jZSA8IDAgewogICAgICAgICAgICBwb3NpdGlvbiAtPSBkaXN0YW5jZSAqIG5vcm1hbDsKICAgICAgICAgICAgbGV0IHZlbG9jaXR5ID0gcG9zaXRpb24gLSBwcmV2aW91czsKICAgICAgICAgICAgbGV0IG5vcm1hbF92ZWxvY2l0eSA9IGRvdCh2ZWxvY2l0eSwgbm9ybWFsKSAqIG5vcm1hbDsKICAgICAgICAgICAgbGV0IHRhbmdlbnRpYWxfdmVsb2NpdHkgPSB2ZWxvY2l0eSAtIG5vcm1hbF92ZWxvY2l0eTsKICAgICAgICAgICAgbGV0IG5ld192ZWxvY2l0eSA9IC1ub3JtYWxfdmVsb2NpdHkgKyB0YW5nZW50aWFsX3ZlbG9jaXR5ICogKDEuMCAtIGZyaWN0aW9uKTsKICAgICAgICAgICAgcHJldmlvdXMgPSBwb3NpdGlvbiAtIG5ld192ZWxvY2l0eTsKICAgICAgICB9CiAgICB9CgogICAgcG9zaXRpb25zW2ldID0gcG9zaXRpb247CiAgICBwcmV2aW91c2VzW2ldID0gcHJldmlvdXM7Cn0K",import.meta.url))).text()}),i=e.createComputePipeline({layout:"auto",compute:{module:o,entryPoint:"main"}}),c=K(e,i,[s,r,n]);return{encode:u=>{const l=u.beginComputePass();l.setPipeline(i),l.setBindGroup(0,c);const y=Math.ceil(t/L);l.dispatchWorkgroups(y),l.end()}}},It=async({device:e,vertexCount:t,deltaBuffer:r,adjacencyBuffer:n,positionBuffer:s,previousBuffer:o,originalBuffer:i,forceBuffer:c})=>{const a=e.createShaderModule({code:await(await fetch(new URL("data:text/wgsl;base64,QGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBkZWx0YTogZjMyOwpAZ3JvdXAoMCkgQGJpbmRpbmcoMSkgdmFyPHN0b3JhZ2UsIHJlYWQ+IGFkamFjZW5jaWVzOiBhcnJheTxhcnJheTxhcnJheTx1MzIsIDI+LCBuPj47CkBncm91cCgwKSBAYmluZGluZygyKSB2YXI8c3RvcmFnZSwgcmVhZD4gb3JpZ2luYWxzOiBhcnJheTx2ZWMyPGYzMj4+OwpAZ3JvdXAoMCkgQGJpbmRpbmcoMykgdmFyPHN0b3JhZ2UsIHJlYWQ+IHBvc2l0aW9uczogYXJyYXk8dmVjMjxmMzI+PjsKQGdyb3VwKDApIEBiaW5kaW5nKDQpIHZhcjxzdG9yYWdlLCByZWFkPiBwcmV2aW91c2VzOiBhcnJheTx2ZWMyPGYzMj4+OwpAZ3JvdXAoMCkgQGJpbmRpbmcoNSkgdmFyPHN0b3JhZ2UsIHJlYWRfd3JpdGU+IGZvcmNlczogYXJyYXk8dmVjMjxmMzI+PjsKCmNvbnN0IHN0aWZmbmVzcyA9IDEwMDAuMDsKY29uc3QgZGFtcGluZyA9IDEwMDAuMDsKY29uc3QgbiA9IDE2dTsKY29uc3QgZXBzaWxvbiA9IDFlLTY7CiAKY29uc3QgaWRlbnRpdHkgPSBtYXQyeDI8ZjMyPigxLjAsIDAuMCwgMC4wLCAxLjApOwpjb25zdCBpbnZhbGlkID0gbWF0MngyPGYzMj4oKTsKCkBjb21wdXRlIEB3b3JrZ3JvdXBfc2l6ZSg2NCkKZm4gbWFpbihAYnVpbHRpbihnbG9iYWxfaW52b2NhdGlvbl9pZCkgZ2xvYmFsX2lkOiB2ZWMzPHUzMj4pIHsKICAgIGxldCBpID0gZ2xvYmFsX2lkLng7CiAgICBmb3JjZXNbaV0gPSBib2R5X2ZvcmNlcyhpKTs7Cn0KCmZuIGJvZHlfZm9yY2VzKGk6IHUzMikgLT4gdmVjMjxmMzI+IHsKICAgIHZhciBmb3JjZSA9IHZlYzI8ZjMyPigwLCAwKTsKICAgIGxldCBhZGphY2VuY3kgPSBhZGphY2VuY2llc1tpXTsKCiAgICBmb3IgKHZhciB6ID0gMHU7IHogPCBuOyB6KyspIHsKICAgICAgICBsZXQgaiA9IGFkamFjZW5jeVt6XVswXTsKICAgICAgICBsZXQgayA9IGFkamFjZW5jeVt6XVsxXTsKICAgICAgICBpZiAoaiA9PSAweGZmZmZmZmZmKSB7IGJyZWFrOyB9CiAgICAgICAgZm9yY2UgKz0gYm9keV9mb3JjZShpLCBqLCBrKTsKICAgIH0KCiAgICByZXR1cm4gZm9yY2U7Cn0KCmZuIGJvZHlfZm9yY2UoaTogdTMyLCBqOiB1MzIsIGs6IHUzMikgLT4gdmVjMjxmMzI+IHsKICAgIGxldCBwMCA9IHBvc2l0aW9uc1tpXTsKICAgIGxldCBwMSA9IHBvc2l0aW9uc1tqXTsKICAgIGxldCBwMiA9IHBvc2l0aW9uc1trXTsKICAgIAogICAgbGV0IHEwID0gcHJldmlvdXNlc1tpXTsKICAgIGxldCBxMSA9IHByZXZpb3VzZXNbal07CiAgICBsZXQgcTIgPSBwcmV2aW91c2VzW2tdOwoKICAgIGxldCByMCA9IG9yaWdpbmFsc1tpXTsKICAgIGxldCByMSA9IG9yaWdpbmFsc1tqXTsKICAgIGxldCByMiA9IG9yaWdpbmFsc1trXTsKCiAgICBsZXQgZGVmb3JtYXRpb24gPSBtYXQyeDIocDEgLSBwMCwgcDIgLSBwMCkgKiBpbnZlcnNlKG1hdDJ4MihyMSAtIHIwLCByMiAtIHIwKSk7CiAgICB2YXIgc2NhbGVfc2hlYXIgPSBtYXQyeDJfc3FydCh0cmFuc3Bvc2UoZGVmb3JtYXRpb24pICogZGVmb3JtYXRpb24pOwogICAgaWYgaXNfaW52YWxpZChzY2FsZV9zaGVhcikgfHwgaXNfaW52YWxpZChpbnZlcnNlKHNjYWxlX3NoZWFyKSkgewogICAgICAgIHJldHVybiB2ZWMyPGYzMj4oKTsKICAgIH0KICAgIHZhciByb3RhdGlvbiA9IGRlZm9ybWF0aW9uICogaW52ZXJzZShzY2FsZV9zaGVhcik7CiAgICBpZiBkZXRlcm1pbmFudChyb3RhdGlvbikgPCAwLjAgewogICAgICAgIHNjYWxlX3NoZWFyICo9IG1hdDJ4MjxmMzI+KC0xLjAsIDAsIDAsIDEuMCk7CiAgICAgICAgcm90YXRpb24gPSBkZWZvcm1hdGlvbiAqIGludmVyc2Uoc2NhbGVfc2hlYXIpOwogICAgfQoKICAgIGxldCBzdHJhaW4gPSBzY2FsZV9zaGVhciAtIGlkZW50aXR5OwogICAgdmFyIHN0cmVzcyA9IHN0aWZmbmVzcyAqIHN0cmFpbjsKCiAgICBsZXQgdjAgPSAocDAgLSBxMCkgLyBkZWx0YTsKICAgIGxldCB2MSA9IChwMSAtIHExKSAvIGRlbHRhOwogICAgbGV0IHYyID0gKHAyIC0gcTIpIC8gZGVsdGE7CgogICAgbGV0IHN0cmFpbl9yYXRlID0gbWF0MngyPGYzMj4odjEgLSB2MCwgdjIgLSB2MCkgKiBpbnZlcnNlKG1hdDJ4MihyMSAtIHIwLCByMiAtIHIwKSk7CgogICAgcmV0dXJuIChyb3RhdGlvbiAqIHN0cmVzcyAtIChleHAoLWRhbXBpbmcgKiBkZWx0YSkgLSAxLjApICogc3RyYWluX3JhdGUpICogKHIxICsgcjIgLSAyICogcjApOwp9CgpmbiBtYXQyeDJfc3FydChtOiBtYXQyeDI8ZjMyPikgLT4gbWF0MngyPGYzMj4gewogICAgbGV0IHRyYWNlID0gbVswXVswXSArIG1bMV1bMV07CiAgICBsZXQgZGV0ID0gbVswXVswXSAqIG1bMV1bMV0gLSBtWzBdWzFdICogbVsxXVswXTsKICAgIAogICAgbGV0IGRpc2NyaW1pbmFudCA9IHRyYWNlICogdHJhY2UgLSA0LjAgKiBkZXQ7CiAgICBpZiBkaXNjcmltaW5hbnQgPCAwLjAgeyByZXR1cm4gaW52YWxpZDsgfQoKICAgIGxldCBsYW1iZGExID0gMC41ICogKHRyYWNlICsgc3FydChkaXNjcmltaW5hbnQpKTsKICAgIGxldCBsYW1iZGEyID0gMC41ICogKHRyYWNlIC0gc3FydChkaXNjcmltaW5hbnQpKTsKICAgIAogICAgdmFyIHYxID0gdmVjMjxmMzI+KG1bMF1bMF0gLSBsYW1iZGEyLCBtWzBdWzFdKTsKICAgIHZhciB2MiA9IHZlYzI8ZjMyPihtWzBdWzFdLCBtWzFdWzFdIC0gbGFtYmRhMSk7CgogICAgaWYgKGxlbmd0aCh2MSkgPD0gZXBzaWxvbiAmJiBsZW5ndGgodjIpIDw9IGVwc2lsb24pIHsKICAgICAgICByZXR1cm4gaW52YWxpZDsKICAgIH0KICAgIAogICAgaWYgKGxlbmd0aCh2MSkgPiBlcHNpbG9uKSB7CiAgICAgICAgdjEgPSBub3JtYWxpemUodjEpOwogICAgfSBlbHNlIHsKICAgICAgICB2MSA9IHBlcnAobm9ybWFsaXplKHYyKSk7CiAgICB9CiAgICAKICAgIGlmIChsZW5ndGgodjIpID4gZXBzaWxvbikgewogICAgICAgIHYyID0gbm9ybWFsaXplKHYyKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdjIgPSBwZXJwKHYxKTsKICAgIH0KICAgIAogICAgbGV0IHYgPSBtYXQyeDI8ZjMyPih2MSwgdjIpOwogICAgbGV0IGRfc3FydCA9IG1hdDJ4MjxmMzI+KHNxcnQoYWJzKGxhbWJkYTEpKSpzaWduKGxhbWJkYTEpLCAwLjAsIDAuMCwgc3FydChhYnMobGFtYmRhMikpKnNpZ24obGFtYmRhMikpOwogICAgbGV0IHZfaW52ID0gbWF0MngyPGYzMj4odlsxXVsxXSwgLXZbMF1bMV0sIC12WzFdWzBdLCB2WzBdWzBdKSAqICgxLjAgLyAodlswXVswXSAqIHZbMV1bMV0gLSB2WzBdWzFdICogdlsxXVswXSkpOwogICAgcmV0dXJuIHYgKiBkX3NxcnQgKiB2X2ludjsKfQoKZm4gcGVycCh2OiB2ZWMyPGYzMj4pIC0+IHZlYzI8ZjMyPiB7CiAgICByZXR1cm4gdmVjMigtdi55LCB2LngpOwp9CgpmbiBkZXRlcm1pbmFudChtOiBtYXQyeDI8ZjMyPikgLT4gZjMyIHsKICAgIHJldHVybiBtWzBdWzBdICogbVsxXVsxXSAtIG1bMF1bMV0gKiBtWzFdWzBdOwp9CgpmbiBpbnZlcnNlKG06IG1hdDJ4MjxmMzI+KSAtPiBtYXQyeDI8ZjMyPiB7CiAgICBsZXQgZGV0ID0gZGV0ZXJtaW5hbnQobSk7CiAgICBpZiBkZXQgPCBlcHNpbG9uIHsgcmV0dXJuIGludmFsaWQ7IH0KICAgIHJldHVybiBtYXQyeDI8ZjMyPigKICAgICAgICBtWzFdWzFdIC8gZGV0LCAtbVswXVsxXSAvIGRldCwKICAgICAgIC1tWzFdWzBdIC8gZGV0LCAgbVswXVswXSAvIGRldAogICAgKTsKfQoKZm4gaXNfaW52YWxpZChtOiBtYXQyeDI8ZjMyPikgLT4gYm9vbCB7CiAgICByZXR1cm4gaW52YWxpZFswXVswXSA9PSBtWzBdWzBdIAogICAgICAgICYmIGludmFsaWRbMV1bMF0gPT0gbVsxXVswXQogICAgICAgICYmIGludmFsaWRbMF1bMV0gPT0gbVswXVsxXQogICAgICAgICYmIGludmFsaWRbMV1bMV0gPT0gbVsxXVsxXTsKfQ==",import.meta.url))).text()}),u=e.createComputePipeline({layout:"auto",compute:{module:a,entryPoint:"main"}}),l=K(e,u,[r,n,i,s,o,c]);return{encode:f=>{const d=f.beginComputePass();d.setPipeline(u),d.setBindGroup(0,l);const m=Math.ceil(t/L);d.dispatchWorkgroups(m),d.end()}}},mt=async({device:e,vertexCount:t,deltaBuffer:r,selectedBuffer:n,anchorBuffer:s,positionBuffer:o,previousBuffer:i,forceBuffer:c})=>{const a=e.createShaderModule({code:await(await fetch(new URL("data:text/wgsl;base64,QGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBkZWx0YTogZjMyOwpAZ3JvdXAoMCkgQGJpbmRpbmcoMSkgdmFyPHVuaWZvcm0+IHNlbGVjdGVkOiB1MzI7CkBncm91cCgwKSBAYmluZGluZygyKSB2YXI8dW5pZm9ybT4gYW5jaG9yOiB2ZWMyPGYzMj47CkBncm91cCgwKSBAYmluZGluZygzKSB2YXI8c3RvcmFnZSwgcmVhZF93cml0ZT4gcG9zaXRpb25zOiBhcnJheTx2ZWMyPGYzMj4+OwpAZ3JvdXAoMCkgQGJpbmRpbmcoNCkgdmFyPHN0b3JhZ2UsIHJlYWRfd3JpdGU+IHByZXZpb3VzZXM6IGFycmF5PHZlYzI8ZjMyPj47CkBncm91cCgwKSBAYmluZGluZyg1KSB2YXI8c3RvcmFnZSwgcmVhZD4gZm9yY2VzOiBhcnJheTx2ZWMyPGYzMj4+OwoKCmNvbnN0IGRhbXBpbmcgPSAwLjA7CmNvbnN0IGdyYXZpdHkgPSB2ZWMyKDAsIC0xMC4wKTsKY29uc3Qgc2l6ZSA9IDAuMDQ7CgpAY29tcHV0ZSBAd29ya2dyb3VwX3NpemUoNjQpCmZuIG1haW4oQGJ1aWx0aW4oZ2xvYmFsX2ludm9jYXRpb25faWQpIGdsb2JhbF9pZDogdmVjMzx1MzI+KSB7CiAgICBsZXQgaSA9IGdsb2JhbF9pZC54OwoKICAgIHZhciBjdXJyZW50ID0gcG9zaXRpb25zW2ldOwogICAgbGV0IHByZXZpb3VzID0gcHJldmlvdXNlc1tpXTsKICAgIGxldCBtYXNzID0gc2l6ZSAqIHNpemU7CiAgICBsZXQgZm9yY2UgPSBmb3JjZXNbaV0gKyBncmF2aXR5ICogbWFzczsKICAgIHZhciBwb3NpdGlvbiA9IGN1cnJlbnQgKyBleHAoLWRhbXBpbmcgKiBkZWx0YSkgKiAoY3VycmVudCAtIHByZXZpb3VzKSArIGZvcmNlIC8gbWFzcyAqIGRlbHRhICogZGVsdGE7CgogICAgaWYgaSA9PSBzZWxlY3RlZCB7CiAgICAgICAgcG9zaXRpb24gPSBhbmNob3I7CiAgICAgICAgY3VycmVudCA9IGFuY2hvcjsKICAgIH0KCiAgICBwcmV2aW91c2VzW2ldID0gY3VycmVudDsKICAgIHBvc2l0aW9uc1tpXSA9IHBvc2l0aW9uOwp9Cg==",import.meta.url))).text()}),u=e.createComputePipeline({layout:"auto",compute:{module:a,entryPoint:"main"}}),l=K(e,u,[r,n,s,o,i,c]);return{encode:f=>{const d=f.beginComputePass();d.setPipeline(u),d.setBindGroup(0,l);const m=Math.ceil(t/L);d.dispatchWorkgroups(m),d.end()}}},Ie=64,bt=async({device:e,vertexCount:t,selectedBuffer:r,anchorBuffer:n,adjacencyBuffer:s,positionBuffer:o,previousBuffer:i,originalBuffer:c,forceBuffer:a,boundaryBuffer:u})=>{const l=w(e,GPUBufferUsage.UNIFORM,new Float32Array([0])),y=b=>e.queue.writeBuffer(l,0,new Float32Array([b])),f=await It({device:e,vertexCount:t,deltaBuffer:l,adjacencyBuffer:s,positionBuffer:o,previousBuffer:i,originalBuffer:c,forceBuffer:a}),d=await mt({device:e,vertexCount:t,deltaBuffer:l,selectedBuffer:r,anchorBuffer:n,positionBuffer:o,previousBuffer:i,forceBuffer:a}),m=await ht({device:e,vertexCount:t,positionBuffer:o,previousBuffer:i,boundaryBuffer:u});return{compute:b=>{y(b/Ie);const p=e.createCommandEncoder();for(let B=0;B<Ie;B++)f.encode(p),d.encode(p),m.encode(p);e.queue.submit([p.finish()])}}};function me(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const Re=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),be=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);be&&parseFloat(be[1]);const R=globalThis,T=globalThis.process||{};function At(e){var n,s;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function ee(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||At()}const Fe="4.0.7";function pt(e){try{const t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}class Ct{constructor(t,r,n="sessionStorage"){this.storage=pt(n),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){const r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}}function wt(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function Bt(e,t=8){const r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var F;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(F||(F={}));const Gt=10;function Ae(e){return typeof e!="string"?e:(e=e.toUpperCase(),F[e]||F.WHITE)}function Zt(e,t,r){return!ee&&typeof e=="string"&&(t&&(e=`\x1B[${Ae(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${Ae(r)+Gt}m${e}\x1B[49m`)),e}function Wt(e,t=["constructor"]){const r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),s=e;for(const o of n){const i=s[o];typeof i=="function"&&(t.find(c=>o===c)||(s[o]=i.bind(e)))}}function te(e,t){if(!e)throw new Error("Assertion failed")}function P(){var t,r,n;let e;if(ee()&&R.performance)e=(r=(t=R==null?void 0:R.performance)==null?void 0:t.now)==null?void 0:r.call(t);else if("hrtime"in T){const s=(n=T==null?void 0:T.hrtime)==null?void 0:n.call(T);e=s[0]*1e3+s[1]/1e6}else e=Date.now();return e}const S={debug:ee()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Mt={enabled:!0,level:0};function x(){}const pe={},Ce={once:!0};class re{constructor({id:t}={id:""}){this.VERSION=Fe,this._startTs=P(),this._deltaTs=P(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Ct(`__probe-${this.id}__`,Mt),this.timeStamp(`${this.id} started`),Wt(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((P()-this._startTs).toPrecision(10))}getDelta(){return Number((P()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,S.warn,arguments,Ce)}error(t){return this._getLogFunction(0,t,S.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,S.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,S.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,S.debug||S.info,arguments,Ce)}table(t,r,n){return r?this._getLogFunction(t,r,console.table||x,n&&[n],{tag:Tt(r)}):x}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||x)}group(t,r,n={collapsed:!1}){const s=we({logLevel:t,message:r,opts:n}),{collapsed:o}=n;return s.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,r,n={}){return this.group(t,r,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||x)}withGroup(t,r,n){this.group(t,r)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Xe(t)}_getLogFunction(t,r,n,s,o){if(this._shouldLog(t)){o=we({logLevel:t,message:r,args:s,opts:o}),n=n||o.method,te(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=P();const i=o.tag||o.message;if(o.once&&i)if(!pe[i])pe[i]=P();else return x;return r=kt(this.id,o.message,o),n.bind(console,r,...o.args)}return x}}re.VERSION=Fe;function Xe(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return te(Number.isFinite(t)&&t>=0),t}function we(e){const{logLevel:t,message:r}=e;e.logLevel=Xe(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const s=typeof e.message;return te(s==="string"||s==="object"),Object.assign(e,{args:n},e.opts)}function kt(e,t,r){if(typeof t=="string"){const n=r.time?Bt(wt(r.total)):"";t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=Zt(t,r.color,r.background)}return t}function Tt(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}const D="4.3.1",Pt=D[0]>="0"&&D[0]<="9"?`v${D}`:"";function St(){const e=new re({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Pt,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const xt=St();function Yt(e,t){return Ve(e||{},t)}function Ve(e,t,r=0){if(r>3)return t;const n={...e};for(const[s,o]of Object.entries(t))o&&typeof o=="object"&&!Array.isArray(o)?n[s]=Ve(n[s]||{},t[s],r+1):n[s]=t[s];return n}const Kt="latest";function zt(){var e;return(e=globalThis._loadersgl_)!=null&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const Lt=zt();function Z(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const W=typeof process!="object"||String(process)!=="[object process]"||process.browser,Et=typeof window<"u"&&typeof window.orientation<"u",Be=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Be&&parseFloat(Be[1]);class Rt{constructor(t,r){g(this,"name");g(this,"workerThread");g(this,"isRunning",!0);g(this,"result");g(this,"_resolve",()=>{});g(this,"_reject",()=>{});this.name=t,this.workerThread=r,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){Z(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Z(this.isRunning),this.isRunning=!1,this._reject(t)}}class v{terminate(){}}const N=new Map;function Ft(e){Z(e.source&&!e.url||!e.source&&e.url);let t=N.get(e.source||e.url);return t||(e.url&&(t=Xt(e.url),N.set(e.url,t)),e.source&&(t=je(e.source),N.set(e.source,t))),Z(t),t}function Xt(e){if(!e.startsWith("http"))return e;const t=Vt(e);return je(t)}function je(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Vt(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function De(e,t=!0,r){const n=r||new Set;if(e){if(Ge(e))n.add(e);else if(Ge(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const s in e)De(e[s],t,n)}}return r===void 0?Array.from(n):[]}function Ge(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const H=()=>{};class ${constructor(t){g(this,"name");g(this,"source");g(this,"url");g(this,"terminated",!1);g(this,"worker");g(this,"onMessage");g(this,"onError");g(this,"_loadableURL","");const{name:r,source:n,url:s}=t;Z(n||s),this.name=r,this.source=n,this.url=s,this.onMessage=H,this.onError=o=>console.log(o),this.worker=W?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&W||typeof v<"u"&&!W}destroy(){this.onMessage=H,this.onError=H,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||De(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=Ft({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new v(n,{eval:!1})}else if(this.source)t=new v(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}}class jt{constructor(t){g(this,"name","unnamed");g(this,"source");g(this,"url");g(this,"maxConcurrency",1);g(this,"maxMobileConcurrency",1);g(this,"onDebug",()=>{});g(this,"reuseWorkers",!0);g(this,"props",{});g(this,"jobQueue",[]);g(this,"idleQueue",[]);g(this,"count",0);g(this,"isDestroyed",!1);this.source=t.source,this.url=t.url,this.setProps(t)}static isSupported(){return $.isSupported()}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,r=(s,o,i)=>s.done(i),n=(s,o)=>s.error(o)){const s=new Promise(o=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});const n=new Rt(r.name,t);t.onMessage=s=>r.onMessage(n,s.type,s.payload),t.onError=s=>r.onError(n,s),r.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!W||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new $({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Et?this.maxMobileConcurrency:this.maxConcurrency}}const Dt={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},G=class G{constructor(t){g(this,"props");g(this,"workerPools",new Map);this.props={...Dt},this.setProps(t),this.workerPools=new Map}static isSupported(){return $.isSupported()}static getWorkerFarm(t={}){return G._workerFarm=G._workerFarm||new G({}),G._workerFarm.setProps(t),G._workerFarm}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:r,source:n,url:s}=t;let o=this.workerPools.get(r);return o||(o=new jt({name:r,source:n,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};g(G,"_workerFarm");let X=G;function vt(e,t={}){const r=t[e.id]||{},n=W?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let s=r.workerUrl;if(!s&&e.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(W?s=`modules/${e.module}/dist/${n}`:s=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!s){let o=e.version;o==="latest"&&(o=Kt);const i=o?`@${o}`:"";s=`https://unpkg.com/@loaders.gl/${e.module}${i}/dist/${n}`}return Z(s),s}function Nt(e,t=Lt){Z(e,"no worker provided");const r=e.version;return!(!t||!r)}function Ht(e,t){return!X.isSupported()||!W&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function Ut(e,t,r,n,s){const o=e.id,i=vt(e,r),a=X.getWorkerFarm(r).getWorkerPool({name:o,url:i});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const u=await a.startJob("process-on-worker",_t.bind(null,s));return u.postMessage("process",{input:t,options:r,context:n}),await(await u.result).result}async function _t(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:s,input:o,options:i}=n;try{const c=await e(o,i);t.postMessage("done",{id:s,result:c})}catch(c){const a=c instanceof Error?c.message:"unknown error";t.postMessage("error",{id:s,error:a})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function Jt(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;const n=new Uint8Array(e),s=new Uint8Array(t);for(let o=0;o<n.length;++o)if(n[o]!==s[o])return!1;return!0}function Ot(...e){return Qt(e)}function Qt(e){const t=e.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=t.reduce((o,i)=>o+i.byteLength,0),n=new Uint8Array(r);let s=0;for(const o of t)n.set(o,s),s+=o.byteLength;return n.buffer}async function*$t(e,t={}){const r=new TextDecoder(void 0,t);for await(const n of e)yield typeof n=="string"?n:r.decode(n,{stream:!0})}async function*qt(e){let t="";for await(const r of e){t+=r;let n;for(;(n=t.indexOf(`
`))>=0;){const s=t.slice(0,n+1);t=t.slice(n+1),yield s}}t.length>0&&(yield t)}async function er(e,t){for(;;){const{done:r,value:n}=await e.next();if(r){e.return();return}if(t(n))return}}async function tr(e){const t=[];for await(const r of e)t.push(r);return Ot(...t)}let rr="";const Ze={};function nr(e){for(const t in Ze)if(e.startsWith(t)){const r=Ze[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${rr}${e}`),e}function sr(e){return e&&typeof e=="object"&&e.isBuffer}function ve(e){if(sr(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Ne(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function or(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const ir=e=>typeof e=="boolean",z=e=>typeof e=="function",E=e=>e!==null&&typeof e=="object",We=e=>E(e)&&e.constructor==={}.constructor,cr=e=>!!e&&typeof e[Symbol.iterator]=="function",ar=e=>e&&typeof e[Symbol.asyncIterator]=="function",M=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,k=e=>typeof Blob<"u"&&e instanceof Blob,ur=e=>e&&typeof e=="object"&&e.isBuffer,lr=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||E(e)&&z(e.tee)&&z(e.cancel)&&z(e.getReader),gr=e=>E(e)&&z(e.read)&&z(e.pipe)&&ir(e.readable),He=e=>lr(e)||gr(e);class fr extends Error{constructor(r,n){super(r);g(this,"reason");g(this,"url");g(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const dr=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,yr=/^([-\w.]+\/[-\w.+]+)/;function Me(e,t){return e.toLowerCase()===t.toLowerCase()}function hr(e){const t=yr.exec(e);return t?t[1]:e}function ke(e){const t=dr.exec(e);return t?t[1]:""}const Ue=/\?.*/;function Ir(e){const t=e.match(Ue);return t&&t[0]}function ne(e){return e.replace(Ue,"")}function mr(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function j(e){return M(e)?e.url:k(e)?e.name||"":typeof e=="string"?e:""}function se(e){if(M(e)){const t=e,r=t.headers.get("content-type")||"",n=ne(t.url);return hr(r)||ke(n)}return k(e)?e.type||"":typeof e=="string"?ke(e):""}function br(e){return M(e)?e.headers["content-length"]||-1:k(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function _e(e){if(M(e))return e;const t={},r=br(e);r>=0&&(t["content-length"]=String(r));const n=j(e),s=se(e);s&&(t["content-type"]=s);const o=await Cr(e);o&&(t["x-first-bytes"]=o),typeof e=="string"&&(e=new TextEncoder().encode(e));const i=new Response(e,{headers:t});return Object.defineProperty(i,"url",{value:n}),i}async function Ar(e){if(!e.ok)throw await pr(e)}async function pr(e){const t=mr(e.url);let r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:e.statusText,url:e.url,response:e};try{const s=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&(s!=null&&s.includes("application/json"))?await e.json():await e.text()}catch{}return new fr(r,n)}async function Cr(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const r=e.slice(0,5);return await new Promise(n=>{const s=new FileReader;s.onload=o=>{var i;return n((i=o==null?void 0:o.target)==null?void 0:i.result)},s.readAsDataURL(r)})}if(e instanceof ArrayBuffer){const r=e.slice(0,5);return`data:base64,${wr(r)}`}return null}function wr(e){let t="";const r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function Br(e){return!Gr(e)&&!Zr(e)}function Gr(e){return e.startsWith("http:")||e.startsWith("https:")}function Zr(e){return e.startsWith("data:")}async function Te(e,t){var r,n;if(typeof e=="string"){const s=nr(e);return Br(s)&&(r=globalThis.loaders)!=null&&r.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(s,t):await fetch(s,t)}return await _e(e)}const Pe=new re({id:"loaders.gl"});class Wr{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Mr{constructor(){g(this,"console");this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const Je={fetch:null,mimeType:void 0,nothrow:!1,log:new Mr,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Re,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kr={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Oe(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Qe(){const e=Oe();return e.globalOptions=e.globalOptions||{...Je},e.globalOptions}function Tr(e,t,r,n){return r=r||[],r=Array.isArray(r)?r:[r],Pr(e,r),xr(t,e,n)}function Pr(e,t){Se(e,null,Je,kr,t);for(const r of t){const n=e&&e[r.id]||{},s=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};Se(n,r.id,s,o,t)}}function Se(e,t,r,n,s){const o=t||"Top level",i=t?`${t}.`:"";for(const c in e){const a=!t&&E(e[c]),u=c==="baseUri"&&!t,l=c==="workerUrl"&&t;if(!(c in r)&&!u&&!l){if(c in n)Pe.warn(`${o} loader option '${i}${c}' no longer supported, use '${n[c]}'`)();else if(!a){const y=Sr(c,s);Pe.warn(`${o} loader option '${i}${c}' not recognized. ${y}`)()}}}}function Sr(e,t){const r=e.toLowerCase();let n="";for(const s of t)for(const o in s.options){if(e===o)return`Did you mean '${s.id}.${o}'?`;const i=o.toLowerCase();(r.startsWith(i)||i.startsWith(r))&&(n=n||`Did you mean '${s.id}.${o}'?`)}return n}function xr(e,t,r){const s={...e.options||{}};return Yr(s,r),s.log===null&&(s.log=new Wr),xe(s,Qe()),xe(s,t),s}function xe(e,t){for(const r in t)if(r in t){const n=t[r];We(n)&&We(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function Yr(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function oe(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e==null?void 0:e.extensions)):!1}function $e(e){me(e,"null loader"),me(oe(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e!=null&&e.parseTextSync||e!=null&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Kr=()=>{const e=Oe();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function zr(){return Kr()}const Lr=/\.([^.]+)$/;async function Er(e,t=[],r,n){if(!qe(e))return null;let s=Ye(e,t,{...r,nothrow:!0},n);if(s)return s;if(k(e)&&(e=await e.slice(0,10).arrayBuffer(),s=Ye(e,t,r,n)),!s&&!(r!=null&&r.nothrow))throw new Error(et(e));return s}function Ye(e,t=[],r,n){if(!qe(e))return null;if(t&&!Array.isArray(t))return $e(t);let s=[];t&&(s=s.concat(t)),r!=null&&r.ignoreRegisteredLoaders||s.push(...zr()),Fr(s);const o=Rr(e,s,r,n);if(!o&&!(r!=null&&r.nothrow))throw new Error(et(e));return o}function Rr(e,t,r,n){const s=j(e),o=se(e),i=ne(s)||(n==null?void 0:n.url);let c=null,a="";return r!=null&&r.mimeType&&(c=U(t,r==null?void 0:r.mimeType),a=`match forced by supplied MIME type ${r==null?void 0:r.mimeType}`),c=c||Xr(t,i),a=a||(c?`matched url ${i}`:""),c=c||U(t,o),a=a||(c?`matched MIME type ${o}`:""),c=c||jr(t,e),a=a||(c?`matched initial data ${tt(e)}`:""),r!=null&&r.fallbackMimeType&&(c=c||U(t,r==null?void 0:r.fallbackMimeType),a=a||(c?`matched fallback MIME type ${o}`:"")),a&&xt.log(1,`selectLoader selected ${c==null?void 0:c.name}: ${a}.`),c}function qe(e){return!(e instanceof Response&&e.status===204)}function et(e){const t=j(e),r=se(e);let n="No valid loader found (";n+=t?`${Ne(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const s=e?tt(e):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function Fr(e){for(const t of e)$e(t)}function Xr(e,t){const r=t&&Lr.exec(t),n=r&&r[1];return n?Vr(e,n):null}function Vr(e,t){t=t.toLowerCase();for(const r of e)for(const n of r.extensions)if(n.toLowerCase()===t)return r;return null}function U(e,t){var r;for(const n of e)if((r=n.mimeTypes)!=null&&r.some(s=>Me(t,s))||Me(t,`application/x.${n.id}`))return n;return null}function jr(e,t){if(!t)return null;for(const r of e)if(typeof t=="string"){if(Dr(t,r))return r}else if(ArrayBuffer.isView(t)){if(Ke(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&Ke(t,0,r))return r;return null}function Dr(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>e.startsWith(n))}function Ke(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(s=>vr(e,t,r,s))}function vr(e,t,r,n){if(n instanceof ArrayBuffer)return Jt(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":const s=q(e,t,n.length);return n===s;default:return!1}}function tt(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?q(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?q(e,0,t):""}function q(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let s="";for(let o=0;o<r;o++)s+=String.fromCharCode(n.getUint8(t+o));return s}const Nr=256*1024;function*Hr(e,t){const r=(t==null?void 0:t.chunkSize)||Nr;let n=0;const s=new TextEncoder;for(;n<e.length;){const o=Math.min(e.length-n,r),i=e.slice(n,n+o);n+=o,yield s.encode(i)}}const Ur=256*1024;function*_r(e,t={}){const{chunkSize:r=Ur}=t;let n=0;for(;n<e.byteLength;){const s=Math.min(e.byteLength-n,r),o=new ArrayBuffer(s),i=new Uint8Array(e,n,s);new Uint8Array(o).set(i),n+=s,yield o}}const Jr=1024*1024;async function*Or(e,t){const r=(t==null?void 0:t.chunkSize)||Jr;let n=0;for(;n<e.size;){const s=n+r,o=await e.slice(n,s).arrayBuffer();n=s,yield o}}function ze(e,t){return Re?Qr(e,t):$r(e)}async function*Qr(e,t){const r=e.getReader();let n;try{for(;;){const s=n||r.read();t!=null&&t._streamReadAhead&&(n=r.read());const{done:o,value:i}=await s;if(o)return;yield ve(i)}}catch{r.releaseLock()}}async function*$r(e,t){for await(const r of e)yield ve(r)}function qr(e,t){if(typeof e=="string")return Hr(e,t);if(e instanceof ArrayBuffer)return _r(e,t);if(k(e))return Or(e,t);if(He(e))return ze(e,t);if(M(e))return ze(e.body,t);throw new Error("makeIterator")}const rt="Cannot convert supplied data type";function en(e,t,r){if(t.text&&typeof e=="string")return e;if(ur(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const s=e.byteLength||e.length;return(e.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+s)),n}throw new Error(rt)}async function tn(e,t,r){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return en(e,t);if(k(e)&&(e=await _e(e)),M(e)){const s=e;return await Ar(s),t.binary?await s.arrayBuffer():await s.text()}if(He(e)&&(e=qr(e,r)),cr(e)||ar(e))return tr(e);throw new Error(rt)}function nt(e,t){const r=Qe(),n=e||r;return typeof n.fetch=="function"?n.fetch:E(n.fetch)?s=>Te(s,n.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:Te}function rn(e,t,r){if(r)return r;const n={fetch:nt(t,e),...e};if(n.url){const s=ne(n.url);n.baseUrl=s,n.queryString=Ir(n.url),n.filename=Ne(s),n.baseUrl=or(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function nn(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function V(e,t,r,n){t&&!Array.isArray(t)&&!oe(t)&&(n=void 0,r=t,t=void 0),e=await e,r=r||{};const s=j(e),i=nn(t,n),c=await Er(e,i,r);return c?(r=Tr(r,c,i,s),n=rn({url:s,_parse:V,loaders:i},r,n||null),await sn(c,e,r,n)):null}async function sn(e,t,r,n){if(Nt(e),r=Yt(e.options,r),M(t)){const o=t,{ok:i,redirected:c,status:a,statusText:u,type:l,url:y}=o,f=Object.fromEntries(o.headers.entries());n.response={headers:f,ok:i,redirected:c,status:a,statusText:u,type:l,url:y}}t=await tn(t,e,r);const s=e;if(s.parseTextSync&&typeof t=="string")return s.parseTextSync(t,r,n);if(Ht(e,r))return await Ut(e,t,r,n,V);if(s.parseText&&typeof t=="string")return await s.parseText(t,r,n);if(s.parse)return await s.parse(t,r,n);throw Z(!s.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function on(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function cn(e){let t=1/0,r=1/0,n=1/0,s=-1/0,o=-1/0,i=-1/0;const c=e.POSITION?e.POSITION.value:[],a=c&&c.length;for(let u=0;u<a;u+=3){const l=c[u],y=c[u+1],f=c[u+2];t=l<t?l:t,r=y<r?y:r,n=f<n?f:n,s=l>s?l:s,o=y>o?y:o,i=f>i?f:i}return[[t,r,n],[s,o,i]]}function an(e,t={}){return{fields:ln(e),metadata:t}}function un(e,t,r){const n=on(t.value),s=r||gn(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:s}}function ln(e){const t=[];for(const r in e){const n=e[r];t.push(un(r,n))}return t}function gn(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}async function fn(e,t,r,n){let s,o;!Array.isArray(t)&&!oe(t)?(s=[],o=t):(s=t,o=r);const i=nt(o);let c=e;return typeof e=="string"&&(c=await i(e)),k(e)&&(c=await i(e)),Array.isArray(s)?await V(c,s,o):await V(c,s,o)}const dn="4.3.1",yn={dataType:null,batchType:null,name:"PLY",id:"ply",module:"ply",version:dn,worker:!0,extensions:["ply"],mimeTypes:["text/plain","application/octet-stream"],text:!0,binary:!0,tests:["ply"],options:{ply:{}}};function hn(e,t){const r=In(e);return an(t,r)}function In(e){const t={};return t.ply_comments=JSON.stringify(e.comments),t.ply_elements=JSON.stringify(e.elements),e.format!==void 0&&(t.ply_format=e.format),e.version!==void 0&&(t.ply_version=e.version),e.headerLength!==void 0&&(t.ply_headerLength=e.headerLength.toString(10)),t}function st(e,t,r){const n=mn(t),s=cn(n),o=t.indices.length||t.vertices.length/3,i=t.indices&&t.indices.length>0,c=i?4:0,a=i?"triangle-list":"point-list",u=hn(e,n),l={loader:"ply",loaderData:e,header:{vertexCount:o,boundingBox:s},schema:u,attributes:n,indices:{value:new Uint32Array(0),size:0},mode:c,topology:a};return t.indices.length>0&&(l.indices={value:new Uint32Array(t.indices),size:1}),l}function mn(e){const t={};for(const r of Object.keys(e))switch(r){case"vertices":e.vertices.length>0&&(t.POSITION={value:new Float32Array(e.vertices),size:3});break;case"normals":e.normals.length>0&&(t.NORMAL={value:new Float32Array(e.normals),size:3});break;case"uvs":e.uvs.length>0&&(t.TEXCOORD_0={value:new Float32Array(e.uvs),size:2});break;case"colors":e.colors.length>0&&(t.COLOR_0={value:new Uint8Array(e.colors),size:3,normalized:!0});break;case"indices":break;default:e[r].length>0&&(t[r]={value:new Float32Array(e[r]),size:1});break}return t}function _(e,t={}){let r,n;if(e instanceof ArrayBuffer){const s=new TextDecoder().decode(e);r=Le(s,t),n=r.format==="ascii"?Ee(s,r):wn(e,r)}else r=Le(e,t),n=Ee(e,r);return st(r,n)}function Le(e,t){const r=/ply([\s\S]*)end_header\s/;let n="",s=0;const o=r.exec(e);o!==null&&(n=o[1],s=o[0].length);const i=n.split(`
`);return bn(i,s,t)}function bn(e,t,r){const n={comments:[],elements:[],headerLength:t};let s,o,i=null;for(let c=0;c<e.length;c++){let a=e[c];if(a=a.trim(),a!=="")switch(o=a.split(/\s+/),s=o.shift(),a=o.join(" "),s){case"format":n.format=o[0],n.version=o[1];break;case"comment":n.comments.push(a);break;case"element":i&&n.elements.push(i),i={name:o[0],count:parseInt(o[1],10),properties:[]};break;case"property":if(i){const u=An(o);r!=null&&r.propertyNameMapping&&u.name in(r==null?void 0:r.propertyNameMapping)&&(u.name=r==null?void 0:r.propertyNameMapping[u.name]),i.properties.push(u)}break;default:console.log("unhandled",s,o)}}return i&&n.elements.push(i),n}function ot(e){const t={indices:[],vertices:[],normals:[],uvs:[],colors:[]};for(const r of e.elements)if(r.name==="vertex")for(const n of r.properties)switch(n.name){case"x":case"y":case"z":case"nx":case"ny":case"nz":case"s":case"t":case"red":case"green":case"blue":break;default:t[n.name]=[];break}return t}function An(e){const t=e[0];switch(t){case"list":return{type:t,name:e[3],countType:e[1],itemType:e[2]};default:return{type:t,name:e[1]}}}function J(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e,10);case"float":case"double":case"float32":case"float64":return parseFloat(e);default:throw new Error(t)}}function pn(e,t){const r=t.split(/\s+/),n={};for(let s=0;s<e.length;s++)if(e[s].type==="list"){const o=[],i=J(r.shift(),e[s].countType);for(let c=0;c<i;c++)o.push(J(r.shift(),e[s].itemType));n[e[s].name]=o}else n[e[s].name]=J(r.shift(),e[s].type);return n}function Ee(e,t){const r=ot(t);let n;const s=/end_header\s([\s\S]*)$/;let o="";(n=s.exec(e))!==null&&(o=n[1]);const i=o.split(`
`);let c=0,a=0;for(let u=0;u<i.length;u++){let l=i[u];if(l=l.trim(),l!==""){a>=t.elements[c].count&&(c++,a=0);const y=pn(t.elements[c].properties,l);it(r,t.elements[c].name,y),a++}}return r}function it(e,t,r={}){if(t==="vertex")for(const n of Object.keys(r))switch(n){case"x":e.vertices.push(r.x,r.y,r.z);break;case"y":case"z":break;case"nx":"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz);break;case"ny":case"nz":break;case"s":"s"in r&&"t"in r&&e.uvs.push(r.s,r.t);break;case"t":break;case"red":"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red,r.green,r.blue);break;case"green":case"blue":break;default:e[n].push(r[n])}else if(t==="face"){const n=r.vertex_indices||r.vertex_index;n.length===3?e.indices.push(n[0],n[1],n[2]):n.length===4&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]))}}function O(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8];default:throw new Error(r)}}function Cn(e,t,r,n){const s={};let o,i=0;for(let c=0;c<r.length;c++)if(r[c].type==="list"){const a=[];o=O(e,t+i,r[c].countType,n);const u=o[0];i+=o[1];for(let l=0;l<u;l++)o=O(e,t+i,r[c].itemType,n),a.push(o[0]),i+=o[1];s[r[c].name]=a}else o=O(e,t+i,r[c].type,n),s[r[c].name]=o[0],i+=o[1];return[s,i]}function wn(e,t){const r=ot(t),n=t.format==="binary_little_endian",s=new DataView(e,t.headerLength);let o,i=0;for(let c=0;c<t.elements.length;c++){const a=t.elements[c].count;for(let u=0;u<a;u++){o=Cn(s,i,t.elements[c].properties,n),i+=o[1];const l=o[0];it(r,t.elements[c].name,l)}}return r}let Y;async function*Bn(e,t){const r=qt($t(e)),n=await Gn(r,t);let s;switch(n.format){case"ascii":s=await Wn(r,n);break;default:throw new Error("Binary PLY can not yet be parsed in streaming mode")}yield st(n,s)}async function Gn(e,t){const r={comments:[],elements:[]};return await er(e,n=>{if(n=n.trim(),n==="end_header")return!0;if(n==="")return!1;const s=n.split(/\s+/),o=s.shift();switch(n=s.join(" "),o){case"ply":break;case"format":r.format=s[0],r.version=s[1];break;case"comment":r.comments.push(n);break;case"element":Y&&r.elements.push(Y),Y={name:s[0],count:parseInt(s[1],10),properties:[]};break;case"property":const i=Zn(s,t.propertyNameMapping);Y.properties.push(i);break;default:console.log("unhandled",o,s)}return!1}),Y&&r.elements.push(Y),r}function Zn(e,t){const r=e[0];switch(r){case"list":return{type:r,name:e[3],countType:e[1],itemType:e[2]};default:return{type:r,name:e[1]}}}async function Wn(e,t){const r={indices:[],vertices:[],normals:[],uvs:[],colors:[]};let n=0,s=0;for await(let o of e)if(o=o.trim(),o!==""){s>=t.elements[n].count&&(n++,s=0);const i=Mn(t.elements[n].properties,o);kn(r,t.elements[n].name,i),s++}return r}function Q(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e,10);case"float":case"double":case"float32":case"float64":return parseFloat(e);default:throw new Error(t)}}function Mn(e,t){const r=t.split(/\s+/),n={};for(let s=0;s<e.length;s++)if(e[s].type==="list"){const o=[],i=Q(r.shift(),e[s].countType);for(let c=0;c<i;c++)o.push(Q(r.shift(),e[s].itemType));n[e[s].name]=o}else n[e[s].name]=Q(r.shift(),e[s].type);return n}function kn(e,t,r={}){switch(t){case"vertex":e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);break;case"face":const n=r.vertex_indices||r.vertex_index;n.length===3?e.indices.push(n[0],n[1],n[2]):n.length===4&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]));break}}const Tn={...yn,parse:async(e,t)=>_(e,t==null?void 0:t.ply),parseTextSync:(e,t)=>_(e,t==null?void 0:t.ply),parseSync:(e,t)=>_(e,t==null?void 0:t.ply),parseInBatches:(e,t)=>Bn(e,t==null?void 0:t.ply)},Pn=async()=>{var l,y;const e=await fn(new URL(""+new URL("abc-Dx55xJp8.ply",import.meta.url).href,import.meta.url).toString(),Tn),t=((l=e.attributes.POSITION)==null?void 0:l.value)??new Float32Array([]),r=((y=e.indices)==null?void 0:y.value)??new Uint32Array([]),n=t.length/2,s=L*Math.ceil(n/L),o=new Float32Array(new Array(s).fill(0).flatMap((f,d)=>{const[m=0,h=0]=t.slice(d*3,d*3+2);return[m,h]})),i=new Array(r.length/3).fill(0).map((f,d)=>{const[m=0,h=0,b=0]=r.slice(d*3,d*3+3);return[m,h,b]}),c=i.length,a=new Array(s).fill(0).reduce((f,d,m)=>(f[m]=i.filter(h=>h.includes(m)).map(([h,b,p])=>h===m?[b,p]:b===m?[p,h]:[h,b]),f),{}),u=new Uint32Array(s*he*2);return u.fill(4294967295),u.set(new Array(s).fill(0).flatMap((f,d)=>new Array(he).fill(0).flatMap((m,h)=>(a[d]??[])[h]??[4294967295,4294967295]))),{vertexCount:n,triangleCount:c,positionData:o,triangleData:r,adjacencyData:u}},Sn=async({device:e,vertexCount:t,aspectBuffer:r,positionBuffer:n})=>{const s=e.createShaderModule({code:await(await fetch(new URL("data:text/wgsl;base64,QGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBhc3BlY3Q6IGYzMjsKQGdyb3VwKDApIEBiaW5kaW5nKDEpIHZhcjxzdG9yYWdlLCByZWFkPiBwb3NpdGlvbnM6IGFycmF5PHZlYzI8ZjMyPj47CgpzdHJ1Y3QgT3V0cHV0IHsKICAgIEBidWlsdGluKHBvc2l0aW9uKSBwb3NpdGlvbjogdmVjNDxmMzI+LAogICAgQGxvY2F0aW9uKDApIEBpbnRlcnBvbGF0ZShmbGF0KSBpbmRleDogdTMyLAp9Cgpjb25zdCB2ZXJ0aWNlcyA9IGFycmF5KAogICAgdmVjMjxmMzI+KC0xLCAtMSksIHZlYzI8ZjMyPigxLCAtMSksIHZlYzI8ZjMyPigtMSwgMSksIAogICAgdmVjMjxmMzI+KC0xLCAxKSwgdmVjMjxmMzI+KDEsIC0xKSwgdmVjMjxmMzI+KDEsIDEpCik7CgpAdmVydGV4CmZuIHZlcnRleCgKICAgIEBidWlsdGluKHZlcnRleF9pbmRleCkgdjogdTMyLAogICAgQGJ1aWx0aW4oaW5zdGFuY2VfaW5kZXgpIGk6IHUzMgopIC0+IE91dHB1dCB7CiAgICBsZXQgcG9zaXRpb24gPSAocG9zaXRpb25zW2ldICsgdmVydGljZXNbdl0gKiAwLjAyKSAqIHZlYzIoMS4wLCBhc3BlY3QpOwogICAgcmV0dXJuIE91dHB1dCh2ZWM0KHBvc2l0aW9uLCAwLCAxLjApLCBpKTsKfQoKQGZyYWdtZW50CmZuIGZyYWdtZW50KEBsb2NhdGlvbigwKSBAaW50ZXJwb2xhdGUoZmxhdCkgaW5kZXg6IHUzMikgLT4gQGxvY2F0aW9uKDApIHUzMiB7CiAgICByZXR1cm4gaW5kZXggKyAxOwp9",import.meta.url))).text()}),o=e.createRenderPipeline({layout:"auto",vertex:{module:s,entryPoint:"vertex"},fragment:{module:s,entryPoint:"fragment",targets:[{format:"r32uint"}]}}),i=K(e,o,[r,n]);return{encode:a=>{a.setPipeline(o),a.setBindGroup(0,i),a.draw(6,t,0,0)}}},xn=async({device:e,vertexCount:t,aspectBuffer:r,positionBuffer:n})=>{const s=await Sn({device:e,vertexCount:t,aspectBuffer:r,positionBuffer:n}),o="r32uint",i=GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_SRC;let c=e.createTexture({size:[1,1],format:o,usage:i});return{pick:async([l,y])=>{const f=e.createBuffer({size:Uint32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),d=e.createCommandEncoder(),m=c.createView(),h=d.beginRenderPass({colorAttachments:[{view:m,loadOp:"clear",storeOp:"store"}]});s.encode(h),h.end(),d.copyTextureToBuffer({texture:c,origin:{x:l,y}},{buffer:f},{width:1,height:1,depthOrArrayLayers:1}),e.queue.submit([d.finish()]),await f.mapAsync(GPUMapMode.READ);const[b=0]=new Uint32Array(f.getMappedRange());return f.destroy(),b-1},resize:l=>{c.destroy(),c=e.createTexture({size:l,format:o,usage:i})}}},Yn=[[-1,-1],[1,-1],[-1,1],[1,1]],Kn=async({device:e,format:t,aspectBuffer:r,boundaryBuffer:n})=>{const s=w(e,GPUBufferUsage.STORAGE,new Float32Array(Yn.flat())),o=e.createShaderModule({code:await(await fetch(new URL("data:text/wgsl;base64,QGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBhc3BlY3Q6IGYzMjsKQGdyb3VwKDApIEBiaW5kaW5nKDEpIHZhcjxzdG9yYWdlLCByZWFkPiBjb3JuZXJzOiBhcnJheTx2ZWMyPGYzMj4+OwpAZ3JvdXAoMCkgQGJpbmRpbmcoMikgdmFyPHN0b3JhZ2UsIHJlYWQ+IGJvdW5kYXJpZXM6IGFycmF5PEJvdW5kYXJ5PjsKCnN0cnVjdCBWZXJ0ZXhPdXRwdXQgewogICAgQGJ1aWx0aW4ocG9zaXRpb24pIGNsaXA6IHZlYzQ8ZjMyPiwKICAgIEBsb2NhdGlvbigwKSBwb3NpdGlvbjogdmVjMjxmMzI+Cn07CgpzdHJ1Y3QgQm91bmRhcnkgewogICAgbm9ybWFsOiB2ZWMyPGYzMj4sCiAgICBvZmZzZXQ6IGYzMgp9OwoKQHZlcnRleApmbiB2ZXJ0ZXgoQGJ1aWx0aW4odmVydGV4X2luZGV4KSBpOiB1MzIpIC0+IFZlcnRleE91dHB1dCB7CiAgICBsZXQgcG9zaXRpb24gPSBjb3JuZXJzW2ldOwogICAgdmFyIG91dHB1dCA9IFZlcnRleE91dHB1dCgpOwogICAgb3V0cHV0LmNsaXAgPSB2ZWM0PGYzMj4ocG9zaXRpb24sIDAuMCwgMS4wKTsKICAgIG91dHB1dC5wb3NpdGlvbiA9IHBvc2l0aW9uIC8gdmVjMigxLjAsIGFzcGVjdCk7CiAgICByZXR1cm4gb3V0cHV0Owp9CgpAZnJhZ21lbnQKZm4gZnJhZ21lbnQoQGxvY2F0aW9uKDApIHBvc2l0aW9uOiB2ZWMyPGYzMj4pIC0+IEBsb2NhdGlvbigwKSB2ZWM0PGYzMj4gewogICAgZm9yICh2YXIgaSA9IDB1OyBpIDwgYXJyYXlMZW5ndGgoJmJvdW5kYXJpZXMpOyBpKyspIHsKICAgICAgICBsZXQgYm91bmRhcnkgPSBib3VuZGFyaWVzW2ldOwogICAgICAgIGxldCBub3JtYWwgPSBib3VuZGFyeS5ub3JtYWw7CiAgICAgICAgbGV0IG9mZnNldCA9IGJvdW5kYXJ5Lm9mZnNldDsKICAgICAgICBsZXQgZGlzdGFuY2UgPSBkb3QocG9zaXRpb24sIG5vcm1hbCkgLSBvZmZzZXQ7CgogICAgICAgIGlmIGRpc3RhbmNlIDwgMCB7CiAgICAgICAgICAgIHJldHVybiB2ZWM0PGYzMj4oMCwgMCwgMCwgMS4wKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdmVjNDxmMzI+KDAuMiwgMC4yLCAwLjIsIDEuMCk7Cn0=",import.meta.url))).text()}),i=e.createRenderPipeline({layout:"auto",vertex:{module:o,entryPoint:"vertex"},fragment:{module:o,entryPoint:"fragment",targets:[{format:t}]},primitive:{topology:"triangle-strip"},multisample:{count:4}}),c=K(e,i,[r,s,n]);return{encode:u=>{u.setPipeline(i),u.setBindGroup(0,c),u.draw(4)}}},zn=async({device:e,format:t,triangleCount:r,aspectBuffer:n,positionBuffer:s,triangleBuffer:o})=>{const i=e.createShaderModule({code:await(await fetch(new URL("data:text/wgsl;base64,QGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBhc3BlY3Q6IGYzMjsKQGdyb3VwKDApIEBiaW5kaW5nKDEpIHZhcjxzdG9yYWdlLCByZWFkPiBwb3NpdGlvbnM6IGFycmF5PHZlYzI8ZjMyPj47CkBncm91cCgwKSBAYmluZGluZygyKSB2YXI8c3RvcmFnZSwgcmVhZD4gdHJpYW5nbGVzOiBhcnJheTxhcnJheTx1MzIsIDM+PjsKCkB2ZXJ0ZXgKZm4gdmVydGV4KAogICAgQGJ1aWx0aW4odmVydGV4X2luZGV4KSB2OiB1MzIsCiAgICBAYnVpbHRpbihpbnN0YW5jZV9pbmRleCkgaTogdTMyCikgLT4gQGJ1aWx0aW4ocG9zaXRpb24pIHZlYzQ8ZjMyPiB7CiAgICByZXR1cm4gdmVjNDxmMzI+KHBvc2l0aW9uc1t0cmlhbmdsZXNbaV1bdl1dICogdmVjMigxLjAsIGFzcGVjdCksIDAuMCwgMS4wKTsKfQoKQGZyYWdtZW50CmZuIGZyYWdtZW50KCkgLT4gQGxvY2F0aW9uKDApIHZlYzQ8ZjMyPiB7CiAgICByZXR1cm4gdmVjNDxmMzI+KDEuMCwgMS4wLCAxLjAsIDEuMCk7Cn0=",import.meta.url))).text()}),c=e.createRenderPipeline({layout:"auto",vertex:{module:i,entryPoint:"vertex"},fragment:{module:i,entryPoint:"fragment",targets:[{format:t}]},multisample:{count:4}}),a=K(e,c,[n,s,o]);return{encode:l=>{l.setPipeline(c),l.setBindGroup(0,a),l.draw(3,r,0,0)}}},Ln=async({device:e,context:t,format:r,triangleCount:n,aspectBuffer:s,triangleBuffer:o,positionBuffer:i,boundaryBuffer:c})=>{const a=await Kn({device:e,format:r,aspectBuffer:s,boundaryBuffer:c}),u=await zn({device:e,triangleCount:n,format:r,aspectBuffer:s,positionBuffer:i,triangleBuffer:o}),l=GPUTextureUsage.RENDER_ATTACHMENT,y=4;let f=e.createTexture({size:[1,1],sampleCount:y,format:r,usage:l});return{resize:([h,b])=>{f.destroy(),f=e.createTexture({size:[h*devicePixelRatio,b*devicePixelRatio],sampleCount:y,format:r,usage:l})},render:()=>{const h=e.createCommandEncoder(),b=f.createView(),p=t.getCurrentTexture().createView(),B=h.beginRenderPass({colorAttachments:[{view:b,resolveTarget:p,loadOp:"clear",storeOp:"discard"}]});a.encode(B),u.encode(B),B.end(),e.queue.submit([h.finish()])}}},En=async()=>{const{gpu:e}=navigator,t=await e.requestAdapter();if(!t)throw new Error;const r=await t.requestDevice(),{queue:n}=r,s=document.createElement("canvas");document.body.appendChild(s);const o=s.getContext("webgpu");if(!o)throw new Error;const i=e.getPreferredCanvasFormat();o.configure({device:r,format:i});const{vertexCount:c,triangleCount:a,positionData:u,triangleData:l,adjacencyData:y}=await Pn(),f=w(r,GPUBufferUsage.UNIFORM,new Float32Array([1])),d=w(r,GPUBufferUsage.UNIFORM,new Uint32Array([-1])),m=w(r,GPUBufferUsage.UNIFORM,new Float32Array([0,0])),h=w(r,GPUBufferUsage.STORAGE,l),b=w(r,GPUBufferUsage.STORAGE,y),p=w(r,GPUBufferUsage.STORAGE,u),B=w(r,GPUBufferUsage.STORAGE,u),ct=w(r,GPUBufferUsage.STORAGE,u),at=w(r,GPUBufferUsage.STORAGE,u.map(()=>0)),ut=[{normal:[0,1],offset:-.5}],ie=w(r,GPUBufferUsage.STORAGE,new Float32Array(ut.flatMap(({normal:[I,A],offset:C})=>[I,A,C,0]))),lt=I=>n.writeBuffer(f,0,new Float32Array([I])),ce=I=>n.writeBuffer(d,0,new Uint32Array([I])),ae=I=>n.writeBuffer(m,0,new Float32Array(I)),gt=await bt({device:r,vertexCount:c,selectedBuffer:d,anchorBuffer:m,adjacencyBuffer:b,positionBuffer:p,previousBuffer:B,originalBuffer:ct,forceBuffer:at,boundaryBuffer:ie}),ue=await Ln({device:r,triangleCount:a,context:o,format:i,aspectBuffer:f,triangleBuffer:h,positionBuffer:p,boundaryBuffer:ie}),le=await xn({device:r,vertexCount:c,aspectBuffer:f,positionBuffer:p});new ResizeObserver(([I])=>{const{width:A=0,height:C=0}=(I==null?void 0:I.contentRect)??{};s.width=A*devicePixelRatio,s.height=C*devicePixelRatio,ue.resize([A,C]),le.resize([A,C]),lt(A/C)}).observe(s);const ge=([I,A])=>{const{width:C,height:ye}=s,ft=C/ye;return[2*(I/(C/devicePixelRatio))-1,(1-2*(A/(ye/devicePixelRatio)))/ft]};s.addEventListener("mousedown",async({x:I,y:A})=>{const C=await le.pick([I,A]);ce(C),ae(ge([I,A]))}),s.addEventListener("mousemove",({x:I,y:A,buttons:C})=>{C!==0&&ae(ge([I,A]))}),s.addEventListener("mouseup",()=>ce(-1));let fe;const de=I=>{requestAnimationFrame(de);const A=(I-(fe??I))/1e3;fe=I,A!==0&&(gt.compute(A),ue.render())};requestAnimationFrame(de)};En();
